@use "../design/colorize" as colorize;
@use "../design/typography" as typography;
@use "../mixins/layout" as layout;
@use "../design/animation" as animation;
@use "../core/constants" as c;

@use "sass:map";
@use "sass:meta";
@use "sass:list";

// Unified, decomposed mixins
@mixin button-structure(
    $padding-y: var(--button-padding-y),
    $padding-x: var(--button-padding-x),
    $gap: var(--gap-xs),
    $radius: var(--radius-sm)
) {
    position: relative;

    pointer-events: auto;
    place-content: center;
    place-items: center;

    font: inherit;
    font-weight: var(--font-weight-medium);
    font-size: var(--text-base);
    text-decoration: none;
    text-overflow: ellipsis;
    white-space: nowrap;
    user-select: none;

    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: $gap;
    padding: $padding-y $padding-x;
    border: none;
    border-radius: $radius;
    cursor: pointer;

    block-size: fit-content;
    inline-size: fit-content;

    line-height: normal;
    max-block-size: stretch;
    max-inline-size: stretch;

    overflow: hidden;
    flex-wrap: nowrap;

    &:disabled {
        opacity: var(--text-opacity-disabled);
        pointer-events: none;
    }

    & > * { max-inline-size: stretch; }

    & :where(span, a) {
        display: inline;
        text-overflow: ellipsis;
        overflow: hidden;
        white-space: nowrap;
        flex-wrap: nowrap;
    }
}

@mixin button-interactions($transition: var(--transition-base, #{c.$ui-duration-standard})) {
    @include animation.transition(all, $transition);
}

@mixin button-colors($surface-opacity: var(--surface-opacity-default), $color-options: ()) {
    @include colorize.surface-interactive($surface-opacity);
    @include colorize.text-color(0);
    @include colorize.solid-colorize("&", $color-options);
}

@mixin button-base {
    @include button-structure();
    @include button-colors();
}

@mixin button-variant($surface-opacity: var(--surface-opacity-default)) {
    @include button-interactions();
    @include button-colors($surface-opacity);
    @include button-base;
}

@mixin button-base-variant($color-options: ()) {
    $resolved-options: map.merge(("shade": 0.0, "tint": 0.0), if(meta.type-of($color-options) == "map", $color-options, ()));

    // Reuse unified structure with alternate sizing tokens
    @include button-structure(var(--space-sm), var(--space-md), var(--space-sm), var(--radius-md));
    @include button-interactions();
    @include button-colors(var(--surface-opacity-default), $resolved-options);
    @include typography.font-style("&");
}

@mixin toolbar-button {
    font-size: var(--font-sm);

    @include button-variant(var(--surface-opacity-default));
    @include layout.container-query("md") { span { display: none; } }
}
