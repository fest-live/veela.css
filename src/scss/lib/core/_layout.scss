@use "sass:map";
@use "sass:list";
@use "sass:meta";

//
//@use "../core/constants" as *;

//
@mixin host-related($host, $child) {
    // outside web component
    #{$host} { & > #{$child} { @content; } }
    // inside web component
    :host(#{$host}) { ::slotted(#{$child}) { @content; } }
}

//
@mixin host-context($host) {
    // outside web component
    #{$host} { @content; }
    // inside web component
    :host(#{$host}) { @content; }
}


// Spacing helpers
@mixin padding($value: null) {
    & {
        @if $value != null { --p: #{$value}; }
        padding: var(--p, var(--padding-md, 0.25rem));
    }
}

//
@mixin margin($value: null) {
    & {
        @if $value != null { --m: #{$value}; }
        margin: var(--m, var(--space-md, 0rem));
    }
}

//
@mixin spacing($p: null, $m: null) {
    & {
        @if $p != null { padding: $p; }
        @if $m != null { margin: $m; }
    }
}

// Border/radius/shadow helpers
@mixin border($width: null, $style: null, $color: null) {
    & {
        @if $width != null { --border-w: #{$width}; }
        @if $style != null { --border-s: #{$style}; }
        @if $color != null { --border-c: #{$color}; }
        border-width: var(--border-w, 0.5px);
        border-style: var(--border-s, solid);
        border-color: var(--border-c, currentColor);
    }
}

// Alignment helpers
@mixin center($axis: "both") {
    & {
        @if $axis == "both" { place-content: center; place-items: center; }
        @else if $axis == "x" { justify-content: center; align-items: stretch; }
        @else if $axis == "y" { align-items: center; justify-content: stretch; }
    }
}


// Border/radius/shadow helpers
@mixin outline($width: null, $style: null, $color: null) {
    & {
        @if $width != null { --outline-w: #{$width}; }
        @if $style != null { --outline-s: #{$style}; }
        @if $color != null { --outline-c: #{$color}; }
        outline-width: var(--outline-w, 0.5px);
        outline-style: var(--outline-s, solid);
        outline-color: var(--outline-c, currentColor);
    }
}

//
@mixin radius($r: null) { & { @if $r != null { --radius: #{$r}; } border-radius: var(--radius, var(--radius-md, 0.25rem)); } }
@mixin border-radius($r: null) { & { @if $r != null { --radius: #{$r}; } border-radius: var(--radius, var(--radius-md, 0.25rem)); } }
@mixin shadow($value: null) { & { @if $value != null { --shadow: #{$value}; } box-shadow: var(--shadow); } }

// Container helpers
// pseudo-container helper for future compatibility

@mixin box($r: null, $ov: null) {
    & {
        @if $r != null { --radius: #{$r}; }
        @if $ov != null { --overflow: #{$ov}; }
        border-radius: var(--radius, var(--radius-md, 0.25rem));
        overflow: var(--overflow, visible);
    }
}

@mixin color($bg: null, $color: null) {
    & {
        @if $bg != null { --bg: #{$bg}; }
        @if $color != null { --fg: #{$color}; }
        color: var(--fg, currentColor);
        background-color: var(--bg, transparent);
    }
}





@mixin flex-center {
    display: flex;
    align-items: center;
    justify-content: center;
}

@mixin flex-between {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

@mixin hover($selector: "&") {
    & {
        @media screen and ((hover: hover) or (pointer: fine)) { #{$selector}:hover { @content; } }
        @media screen and ((hover: none) and (pointer: coarse)) { #{$selector}:active { @content; } }
    }
}

// Sizing
@mixin size($inline: null, $block: null, $aspect-ratio: null) {
    & {
        @if $inline != null { --i-size: #{$inline}; }
        @if $block != null { --b-size: #{$block}; }
        @if $aspect-ratio != null { --ar: #{$aspect-ratio}; }
        inline-size: var(--i-size, 100%);
        block-size: var(--b-size, 100%);
        aspect-ratio: var(--ar, auto);
    }
}

@mixin position($type: null, $inset: null) {
    & {
        @if $type != null { --pos: #{$type}; }
        @if $inset != null { --inset: #{$inset}; }
        position: var(--pos, absolute);
        inset: var(--inset, 0);
    }
}

@mixin display($type: null, $direction: null, $items: null, $content: null) {
    & {
        @if $type != null { --display: #{$type}; }
        @if $direction != null { --flow: #{$direction}; }
        @if $items != null { --items: #{$items}; }
        @if $content != null { --content: #{$content}; }
        display: var(--display, inline-block);
        flex-direction: var(--flow, row);
        place-items: var(--items, center);
        place-content: var(--content, center);
        box-sizing: border-box;
    }
}

@mixin interaction($pointerEvents: null, $cursor: null, $userSelect: null) {
    & {
        @if $pointerEvents != null { --pe: #{$pointerEvents}; }
        @if $userSelect != null { --us: #{$userSelect}; }
        @if $cursor != null { --cursor: #{$cursor}; }
        pointer-events: var(--pe, auto);
        user-select: var(--us, none);
        cursor: var(--cursor, default);
    }
}

@mixin scrollbar($overflow: null, $width: null, $color: null, $gutter: null) {
    & {
        @if $width != null { --sb-w: #{$width}; }
        @if $color != null { --sb-c: #{$color}; }
        @if $gutter != null { --sb-g: #{$gutter}; }
        @if $overflow != null { --ov: #{$overflow}; }
        scrollbar-width: var(--sb-w, thin);
        scrollbar-color: var(--sb-c, transparent transparent);
        scrollbar-gutter: var(--sb-g, auto);
        overflow: var(--ov, hidden);
    }
}

@mixin place($method: stretch, $items: center) {
    & { place-content: #{$method}; place-items: #{$items}; }
}

@mixin grid-flow($direction: row) {
    & {
        display: grid;
        grid-auto-flow: #{$direction};
    }
}

@mixin grid-center {
    display: grid;
    place-items: center;
}

@mixin flex-flow($direction: row) {
    & {
        display: flex;
        flex-direction: #{$direction};
    }
}

@mixin grid-column {
    @include grid-flow(row);
    @include place(center);

    & {
        --order: sibling-index();
        grid-column: var(--order, 1) / calc(var(--order, 1) + 1);
        grid-row: 1 / -1;
        grid-template-columns: minmax(0px, 1fr);
        grid-template-rows: subgrid;
    }
}

@mixin grid-row {
    @include grid-flow(column);
    @include place(center);

    & {
        --order: sibling-index();
        grid-column: 1 / -1;
        grid-row: var(--order, 1) / calc(var(--order, 1) + 1);
        grid-template-columns: subgrid;
        grid-template-rows: minmax(0px, max-content);
    }
}

@mixin flex-column {
    & {
        --order: sibling-index();
        order: var(--order, auto);
        flex: 1 1 max-content;
    }

    @include place(center);
}

@function limit-by-size($pwidth, $basis: 100%, $min: 0px) {
    @return max(calc($basis - ($basis - $pwidth)), $min);
}

@mixin inline-stretch { & { inline-size: 100%; inline-size: -webkit-fill-available; inline-size: stretch; } }
@mixin block-stretch { & { block-size: 100%; block-size: -webkit-fill-available; block-size: stretch; } }
@mixin content-inline-size { & { padding-inline: limit-by-size(calc(var(--content-inline-size, 100%) * 0.5), 100%); } }
@mixin content-block-size { & { padding-block: limit-by-size(calc(var(--content-block-size, 100%) * 0.5), 100%); } }
@mixin ux-anchor { & { transform: scale3d(var(--scale, 1), var(--scale, 1), 1) translate3d(var(--translate-x, 0px), var(--translate-y, 0px), 0px); } }

@mixin grid-layered {
    & { grid-template-columns: minmax(0px, 1fr); grid-template-rows: minmax(0px, 1fr); }
    & > * { grid-column: 1 / -1; grid-row: 1 / -1; }
}

@mixin grid-rows-3c { & { grid-template-columns: minmax(0px, max-content) minmax(0px, 1fr) minmax(0px, max-content); } }

@mixin grid-layout($columns: minmax(0px, 1fr), $rows: minmax(0px, 1fr), $type: inline) {
    display: #{$type} grid;
    grid-template-columns: #{$columns};
    grid-template-rows: #{$rows};
}

@mixin grid-auto-fill($min-size: null) {
    @if $min-size != null { --min-col-size: #{$min-size}; }
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(var(--min-col-size, 260px), 1fr));
    gap: var(--gap-md);
}

@mixin scrollable($direction: "y") {
    @if $direction == "x" {
        overflow-x: auto;
        overflow-y: hidden;
    }

    @else if $direction == "y" {
        overflow-y: auto;
        overflow-x: hidden;
    }

    @else {
        overflow: auto;
    }

    scrollbar-width: thin;
    scrollbar-color: oklch(
        from --c2-on-surface(
            var(--scrollbar-tint),
            var(--current, var(--color-on-surface, var(--md3-on-surface, #1c1b1f)))
        ) l c h / var(--scrollbar-opacity)
    ) transparent;
    -webkit-overflow-scrolling: touch;

    &::-webkit-scrollbar {
        inline-size: 6px;
        block-size: 6px;
    }

    &::-webkit-scrollbar-thumb {
        background: oklch(
            from --c2-on-surface(
                var(--scrollbar-tint),
                var(--current, var(--color-on-surface, var(--md3-on-surface, #1c1b1f)))
            ) l c h / var(--scrollbar-opacity)
        );
        border-radius: var(--radius-full);
    }

    &::-webkit-scrollbar-track {
        background: transparent;
    }
}

@mixin hide-scrollbar {
    scrollbar-width: none;

    &::-webkit-scrollbar {
        display: none;
    }
}

@mixin breakpoint($size) {
    $map: (
        "sm": 480px,
        "md": 720px,
        "lg": 960px,
        "xl": 1200px
    );

    $limit: map.get($map, $size);

    @if $limit {
        @media (max-width: $limit) { @content; }
    } @else {
        @media (max-width: #{$size}) { @content; }
    }
}

@mixin breakpoint-up($size) {
    $map: (
        "sm": 481px,
        "md": 721px,
        "lg": 961px,
        "xl": 1201px
    );

    $limit: map.get($map, $size);

    @if $limit {
        @media (min-width: $limit) { @content; }
    } @else {
        @media (min-width: #{$size}) { @content; }
    }
}

@mixin container-query($size) {
    $map: (
        "sm": 480px,
        "md": 720px,
        "lg": 960px
    );

    $limit: map.get($map, $size);

    @if $limit {
        @container (max-inline-size: $limit) { @content; }
    } @else {
        @container (max-inline-size: #{$size}) { @content; }
    }
}

@mixin flex($direction: row, $items: center, $content: center) {
    @include display('flex', $direction, $items, $content);
}

@mixin grid($columns: minmax(0px, 1fr), $rows: minmax(0px, var(--ui-window-frame-titlebar-height)) minmax(0px, 1fr)) {
    display: grid;
    grid-template-columns: #{$columns};
    grid-template-rows: #{$rows};
    grid-column: 1 / -1;
    grid-row: 1 / -1;
}

//
@mixin container-base($size: stretch, $strict: false, $type: size, $name: auto, $contain: strict) {
    & {
        container-type: $type;
        @if $name != auto { container-name: $name; }
        contain: $contain;
    }

    @if $strict {
        @include size($size);
    }
    @else {
        @include size(stretch);
    }
}

@mixin container-layout($type: ui-container, $contain: strict) {
    @include container-base(stretch, false, $type, auto, $contain);
}

// Container query variants
@mixin container($size) {
    max-inline-size: stretch;//$container-max-width;

    $map: (
        "sm": 480px,
        "md": 720px,
        "lg": 960px
    );

    $limit: map.get($map, $size);

    /*@include media-down(md) {
        padding: 0 $spacing-md;
    }*/

    @if $limit {
        @container (max-inline-size: $limit) { @content; }
    } @else {
        @container (max-inline-size: #{$size}) { @content; }
    }
}


@mixin text($size: $ui-font-base-size, $weight: 400, $color: currentColor) {
    font-size: #{$size};
    font-weight: #{$weight};
    color: #{$color};
}

@mixin text-ellipsis {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

// =============================================================================
// RESPONSIVE MIXINS
// =============================================================================

@mixin media-up($breakpoint) {
    @if $breakpoint == sm {
        @media (min-width: $breakpoint-sm) {
            @content;
        }
    } @else if $breakpoint == md {
        @media (min-width: $breakpoint-md) {
            @content;
        }
    } @else if $breakpoint == lg {
        @media (min-width: $breakpoint-lg) {
            @content;
        }
    } @else if $breakpoint == xl {
        @media (min-width: $breakpoint-xl) {
            @content;
        }
    } @else if $breakpoint == 2xl {
        @media (min-width: $breakpoint-2xl) {
            @content;
        }
    }
}

//
@mixin media-down($breakpoint) {
    @if $breakpoint == sm {
        @media (max-width: #{$breakpoint-sm - 1px}) {
            @content;
        }
    } @else if $breakpoint == md {
        @media (max-width: #{$breakpoint-md - 1px}) {
            @content;
        }
    } @else if $breakpoint == lg {
        @media (max-width: #{$breakpoint-lg - 1px}) {
            @content;
        }
    } @else if $breakpoint == xl {
        @media (max-width: #{$breakpoint-xl - 1px}) {
            @content;
        }
    } @else if $breakpoint == 2xl {
        @media (max-width: #{$breakpoint-2xl - 1px}) {
            @content;
        }
    }
}

@mixin media-between($min, $max) {
    @media (min-width: $min) and (max-width: #{$max - 1px}) {
        @content;
    }
}

// =============================================================================
// LAYOUT MIXINS
// =============================================================================

@mixin flex-center {
    display: flex;
    align-items: center;
    justify-content: center;
}

@mixin flex-between {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

@mixin flex-column {
    display: flex;
    flex-direction: column;
}

@mixin grid-center {
    display: grid;
    place-items: center;
}

@mixin grid-auto-fit($min-width: 250px) {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax($min-width, 1fr));
    gap: $spacing-lg;
}

// =============================================================================
// VISUAL EFFECTS MIXINS
// (moved to design/_effects.scss)
// =============================================================================

// =============================================================================
// UTILITY MIXINS
// =============================================================================

@mixin sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

@mixin truncate {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

@mixin aspect-ratio($width, $height) {
    position: relative;

    &::before {
        content: "";
        display: block;
        padding-top: calc(#{$height} / #{$width} * 100%);
    }

    & > * {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }
}


//
@mixin typography($fs, $ff: $def-ff, $weight: 400) {
    & {
        font-size: $fs;
        font-family: $ff;
        font-weight: $weight;
    }
}

//
@mixin font-style($selector: "&", $options: (
    "size": "base",
    "weight": 400,
    "family": "inherit"
)) {
    #{$selector} {
        $size: map.get($options, "size") or "base";
        $family: map.get($options, "family") or "inherit";
        $weight: map.get($options, "weight") or 400;

        //
        @include typography(
            var(--text-#{$size}),
            #{$family},
            #{$weight}
        );
    }
}

//
@mixin fit-content-inline {
    interpolate-size: allow-keywords;
    min-inline-size: min-content;
    max-inline-size: stretch;
    inline-size: fit-content;
}

//
@mixin fit-content-block {
    interpolate-size: allow-keywords;
    min-block-size: min-content;
    max-block-size: stretch;
    block-size: fit-content;
}

//
@mixin stretch-inline {
    interpolate-size: allow-keywords;
    max-inline-size: stretch;
    inline-size: stretch;
}

//
@mixin stretch-block {
    interpolate-size: allow-keywords;
    max-block-size: stretch;
    block-size: stretch;
}

//
@mixin stretch {
    interpolate-size: allow-keywords;
    max-inline-size: stretch;
    max-block-size: stretch;
    inline-size: stretch;
    block-size: stretch;
}

//
@mixin container-inline-clamped($inline: max-content) {
    interpolate-size: allow-keywords;
    max-inline-size: stretch;
    inline-size: calc-size($inline, clamp(0px, size, min(100cqi, 100dvi)));
    min-inline-size: min-content;
}

//
@mixin container-block-clamped($block: max-content) {
    interpolate-size: allow-keywords;
    max-block-size: stretch;
    block-size: calc-size($block, clamp(0px, size, min(100cqb, 100dvb)));
    min-block-size: min-content;
}

//
@mixin container-clamped($inline: max-content, $block: max-content) {
    interpolate-size: allow-keywords;
    @include container-inline-clamped($inline);
    @include container-block-clamped($block);
}
