/**
 * Unified CSS Custom Property Registration System
 * 
 * This module consolidates property registration logic used across the library.
 * It provides a single source of truth for @property declarations via the
 * CSS Properties and Values API (CSS Houdini).
 * 
 * Used by:
 * - lib/core/_properties.scss (orientation, transform, layout properties)
 * - lib/basic/_typed-properties.scss (UI component properties)
 * - lib/advanced/design/ (MD3 design properties)
 */

@use "sass:map";
@use "sass:meta";

// ============================================================================
// Default initial values by CSS type
// ============================================================================

$_default-initial-values: (
    "integer": 0,
    "number": 0.0,
    "color": #0000,
    "boolean": false,
    "string": "",
    "length": 0px,
    "length-percentage": 0px,
    "angle": 0deg,
    "percentage": 0%,
    "time": 0ms,
    "frequency": 0hz,
) !default;

// ============================================================================
// Helper: Get option or fallback value
// ============================================================================

@function _option-or($options, $key, $fallback) {
    $value: map.get($options, $key);
    @return if($value == null, $fallback, $value);
}

// ============================================================================
// Mixin: Register a single CSS Custom Property
// ============================================================================

///
/// Registers a single CSS Custom Property via the Properties & Values API.
///
/// Accepts a map with keys:
/// - syntax: (string) CSS property syntax (e.g., "<color>", "<length>")
/// - initial or initial-value: (any) default value for the property
/// - inherits: (boolean) whether property inherits (defaults to true)
///
/// @example
///   @include register-property("--my-color", ("syntax": "<color>", "initial": #fff, "inherits": false));
///
@mixin register-property($name, $definition) {
    $config: if(meta.type-of($definition) == "map", $definition, ());

    $syntax: map.get($config, "syntax") or "<number>";
    $initial: if(
        map.has-key($config, "initial-value"),
        map.get($config, "initial-value"),
        map.get($config, "initial")
    ) or _option-or($_default-initial-values, $syntax, 0.0);
    $inherits: if(map.has-key($config, "inherits"), map.get($config, "inherits"), true);

    @property #{$name} {
        @if $syntax != null { syntax: "#{$syntax}"; }
        @if $inherits != null { inherits: $inherits; }
        @if $initial != null { initial-value: #{$initial}; }
    }
}

// ============================================================================
// Mixin: Register multiple CSS Custom Properties at once
// ============================================================================

///
/// Registers multiple CSS Custom Properties at once from one or more maps.
///
/// Each map entry should follow the format used by `register-property`.
/// Multiple maps can be passed as arguments.
///
/// @example
///   @include register-properties((
///       "--my-color": ("syntax": "<color>", "initial": #fff),
///       "--my-size": ("syntax": "<length>", "initial": 0px),
///   ));
///
@mixin register-properties($bundles...) {
    @each $bundle in $bundles {
        @if meta.type-of($bundle) == "map" {
            @each $name, $definition in $bundle {
                @include register-property($name, $definition);
            }
        } @else if $bundle != null {
            @warn "register-properties expects map entries, received #{meta.type-of($bundle)}.";
        }
    }
}
