@use "sass:list";
@use "sass:map";
@use "sass:math";
@use "sass:meta";
@use "sass:string";

// Re-export unified property registration system
@use "./register-properties" as *;

//
@function option-or($options, $key, $fallback) {
    $value: map.get($options, $key);
    @return if($value == null, $fallback, $value);
}

//
// Fetch function
@function md3-fetch($source, $token, $label: "token") {
    @if map.has-key($source, $token) {
        @return map.get($source, $token);
    }

    @error "Unknown #{$label} `#{$token}`. Available: #{map.keys($source)}";
}

//
@mixin when-hover($selector: "&") {
    @media (hover: hover) and (pointer: fine) { #{$selector}:hover { @content; } }
    @media (hover: none) and (pointer: coarse) { #{$selector}:active { @content; } }
}

//
@mixin when-active($selector: "&") {
    @media (hover: hover) and (pointer: fine) { #{$selector}:active { @content; } }
}

//
@mixin when-focus($selector: "&") {
    @media (hover: hover) and (pointer: fine) { #{$selector}:focus-visible { @content; } }
    @media (hover: none) and (pointer: coarse) { #{$selector}:focus { @content; } }
}

//
@mixin when-focus-visible($selector: "&") {
    @media (hover: hover) and (pointer: fine) { #{$selector}:focus-visible { @content; } }
    @media (hover: none) and (pointer: coarse) { #{$selector}:focus-visible { @content; } }
}

//
@mixin when-disabled($selector: "&") {
    @media (hover: hover) and (pointer: fine) { #{$selector}:disabled, #{$selector}[aria-disabled="true"] { @content; } }
    @media (hover: none) and (pointer: coarse) { #{$selector}:disabled, #{$selector}[aria-disabled="true"] { @content; } }
}

//
@mixin when-selected($selector: "&") {
    @media (hover: hover) and (pointer: fine) { #{$selector}::selection, #{$selector}:checked, #{$selector}[aria-selected="true"] { @content; } }
    @media (hover: none) and (pointer: coarse) { #{$selector}::selection, #{$selector}:checked, #{$selector}[aria-selected="true"] { @content; } }
}

//
@mixin when-autofill($selector: "&") {
    #{$selector}:-webkit-autofill { @content; }
    #{$selector}:autofill { @content; }
    #{$selector}:auto-fill { @content; }
}

@mixin hover($selector: "&") {
    @include when-hover { #{$selector}:hover { @content; } }
    @include when-active { #{$selector}:active { @content; } }
}
