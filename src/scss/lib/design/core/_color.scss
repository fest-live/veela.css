@use "sass:list";
@use "sass:map";
@use "sass:math";
@use "sass:meta";
@use "sass:string";

//
@use "utils" as _;

//
// Surface role map
$md3-surface-role-map: (
    primary: on-primary,
    primary-container: on-primary-container,
    primary-fixed: on-primary-fixed,
    primary-fixed-dim: on-primary-fixed,
    secondary: on-secondary,
    secondary-container: on-secondary-container,
    secondary-fixed: on-secondary-fixed,
    secondary-fixed-dim: on-secondary-fixed,
    tertiary: on-tertiary,
    tertiary-container: on-tertiary-container,
    tertiary-fixed: on-tertiary-fixed,
    tertiary-fixed-dim: on-tertiary-fixed,
    error: on-error,
    error-container: on-error-container,
    surface: on-surface,
    surface-dim: on-surface,
    surface-bright: on-surface,
    surface-variant: on-surface-variant,
    surface-container-lowest: on-surface,
    surface-container-low: on-surface,
    surface-container: on-surface,
    surface-container-high: on-surface,
    surface-container-highest: on-surface,
    background: on-background,
    inverse-surface: inverse-on-surface,
    outline: on-surface,
    outline-variant: on-surface,
    surface-tint: on-surface,
);

//
// State opacity
$md3-state-opacity: (
    hover: 0.08,
    focus: 0.12,
    focus-visible: 0.12,
    focus-ring: 0.22,
    press: 0.12,
    drag: 0.16,
    selected: 0.16,
    disabled: 0.38,
    icon: 0.54,
);

//
// State function
@function md3-state($state) {
    @return _.md3-fetch($md3-state-opacity, $state, "state");
}

//
// Variable function
@function md3-var($role) {
    @return "--md-#{$role}";
}

//
// Material role map
$material-role-map: (
    primary: "--md-sys-color-primary",
    on-primary: "--md-sys-color-on-primary",
    primary-container: "--md-sys-color-primary-container",
    on-primary-container: "--md-sys-color-on-primary-container",
    secondary: "--md-sys-color-secondary",
    on-secondary: "--md-sys-color-on-secondary",
    secondary-container: "--md-sys-color-secondary-container",
    on-secondary-container: "--md-sys-color-on-secondary-container",
    tertiary: "--md-sys-color-tertiary",
    on-tertiary: "--md-sys-color-on-tertiary",
    tertiary-container: "--md-sys-color-tertiary-container",
    on-tertiary-container: "--md-sys-color-on-tertiary-container",
    error: "--md-sys-color-error",
    on-error: "--md-sys-color-on-error",
    error-container: "--md-sys-color-error-container",
    on-error-container: "--md-sys-color-on-error-container",
    surface: "--md-sys-color-surface",
    on-surface: "--md-sys-color-on-surface",
    surface-variant: "--md-sys-color-surface-variant",
    on-surface-variant: "--md-sys-color-on-surface-variant",
    outline: "--md-sys-color-outline",
    outline-variant: "--md-sys-color-outline-variant",
    background: "--md-sys-color-background",
    on-background: "--md-sys-color-on-background",
    inverse-surface: "--md-sys-color-inverse-surface",
    inverse-on-surface: "--md-sys-color-inverse-on-surface",
    inverse-primary: "--md-sys-color-inverse-primary",
    surface-tint: "--md-sys-color-surface-tint",
);

//
// Material mode suffix
$material-mode-suffix: (
    light: "",
    dark: "-dark",
);



//
// Export state vars mixin
@mixin md3-export-state-vars() {
    --state-opacity-hover: #{md3-state(hover)};
    --state-opacity-focus: #{md3-state(focus)};
    --state-opacity-press: #{md3-state(press)};
    --state-opacity-drag: #{md3-state(drag)};
    --state-opacity-selected: #{md3-state(selected)};
    --state-opacity-disabled: #{md3-state(disabled)};
    --state-opacity-icon: #{md3-state(icon)};

    --surface-opacity-subtle: 0.02;
    --surface-opacity-muted: 0.04;
    --surface-opacity-default: 0.06;
    --surface-opacity-emphasis: 0.08;
    --surface-opacity-strong: 0.10;

    --contrast-opacity-subtle: 0.02;
    --contrast-opacity-muted: 0.04;
    --contrast-opacity-default: 0.06;
    --contrast-opacity-emphasis: 0.08;
    --contrast-opacity-strong: 0.10;

    --text-tint-primary: 0;
    --text-tint-secondary: 0.04;
    --text-tint-muted: 0.08;
    --text-tint-disabled: 0.1;//#{md3-state(disabled)};

    --border-opacity-subtle: 0.04;
    --border-opacity-default: 0.06;
    --border-opacity-emphasis: 0.08;
    --border-opacity-strong: 0.10;
    --border-opacity-dashed: 0.12;

    --outline-opacity: 0.4;
    --outline-tint: 0;

    --scrollbar-opacity: 0.4;
    --scrollbar-tint: 0.1;

    --interaction-tone-direction: 1;
    --hover-lift: calc(0.04 * var(--interaction-tone-direction, 1));
    --active-lift: calc(0.05 * var(--interaction-tone-direction, 1));
    --focus-lift: calc(0.06 * var(--interaction-tone-direction, 1));
    --selection-opacity: 0.1;
}

//
// Material color utilities theme mixin
@mixin material-color-utilities-theme($mode, $selector) {
    $suffix: map.get($material-mode-suffix, $mode);

    #{$selector} {
        @each $role, $source in $material-role-map {
            #{md3-var($role)}: var(#{$source}#{$suffix}, #{md3-color($role, $mode)});
        }
    }
}

//
// Material color utilities remap mixin
@mixin material-color-utilities-remap($system-selector: ":where(:root, :host, :scope, body, div, section, html)") {
    @at-root {
        @layer md3.mcu {
            #{$system-selector}:not([data-scheme]):not([data-theme]),
            #{$system-selector}:where([data-scheme="auto"], [data-theme="auto"]),
            #{$system-selector}:where([data-scheme="system"], [data-theme="system"])
            {
                @media (prefers-color-scheme: light) { @include material-color-utilities-theme(light, "&"); }
                @media (prefers-color-scheme: dark)  { @include material-color-utilities-theme(dark, "&"); }
            }

            //
            #{$system-selector}:where([data-theme="dark"] , [data-scheme="dark"] ) { @include material-color-utilities-theme(dark , "&"); }
            #{$system-selector}:where([data-theme="light"], [data-scheme="light"]) { @include material-color-utilities-theme(light, "&"); }
        }
    }
}
