@use "sass:list";
@use "sass:map";
@use "sass:math";
@use "sass:meta";
@use "sass:string";

//
@use "utils" as _;
@use "shadow" as _shadow;


// =============================================================================
// LAYOUT & BREAKPOINTS
// =============================================================================



//
// Space scale
$md3-space-scale: (
    2xs: clamp(0.1875rem, 0.4cqi + 0.05rem, 0.25rem),
    xs: clamp(0.25rem, 0.45cqi + 0.06rem, 0.5rem),
    sm: clamp(0.5rem, 0.6cqi + 0.1rem, 0.75rem),
    md: clamp(0.75rem, 0.8cqi + 0.18rem, 1rem),
    lg: clamp(1rem, 1cqi + 0.24rem, 1.5rem),
    xl: clamp(1.5rem, 1.4cqi + 0.32rem, 2rem),
    2xl: clamp(2rem, 2cqi + 0.4rem, 2.75rem),
    3xl: clamp(2.75rem, 2.6cqi + 0.6rem, 3.5rem),
    4xl: clamp(3.5rem, 3cqi + 0.8rem, 4.5rem),
);

//
// Radius scale
$md3-radius-scale: (
    xs: clamp(0.25rem, 0.6cqi, 0.375rem),
    sm: clamp(0.5rem, 0.9cqi, 0.75rem),
    md: clamp(0.75rem, 1cqi, 1rem),
    lg: clamp(0.85rem, 1.2cqi, 1.2rem),
    xl: clamp(1rem, 1.5cqi, 1.4rem),
    full: 9999px,
);

//
// Shape scale
$md3-shape-scale: (
    corner-none: 0,
    extra-small: clamp(0.25rem, 0.6cqi, 0.375rem),
    extra-small-top: clamp(0.25rem, 0.6cqi, 0.375rem) clamp(0.25rem, 0.6cqi, 0.375rem) 0 0,
    small: clamp(0.5rem, 0.9cqi, 0.75rem),
    small-top: clamp(0.5rem, 0.9cqi, 0.75rem) clamp(0.5rem, 0.9cqi, 0.75rem) 0 0,
    medium: clamp(0.75rem, 1.2cqi, 1rem),
    large: clamp(1rem, 1.5cqi, 1.5rem),
    large-top: clamp(1rem, 1.5cqi, 1.5rem) clamp(1rem, 1.5cqi, 1.5rem) 0 0,
    large-end: clamp(1rem, 1.5cqi, 1.5rem) clamp(1rem, 1.5cqi, 1.5rem) 0 0,
    extra-extra-large: clamp(2rem, 2.4cqi, 2.5rem),
    extra-large: clamp(1.75rem, 2.4cqi, 2.25rem),
    extra-large-top: clamp(1.75rem, 2.4cqi, 2.25rem) clamp(1.75rem, 2.4cqi, 2.25rem) 0 0,
    extra-large-bottom: 0 0 clamp(1.75rem, 2.4cqi, 2.25rem) clamp(1.75rem, 2.4cqi, 2.25rem),
    full: 9999px,
);

//
// Radius aliases
$md3-radius-aliases: (
    3xs: xs,
    2xs: xs,
    xs: xs,
    extra-small: xs,
    sm: sm,
    small: sm,
    md: md,
    medium: md,
    lg: lg,
    large: lg,
    xl: xl,
    extra-large: xl,
    2xl: xl,
    3xl: xl,
    4xl: xl,
    full: full,
);

//
// Shape aliases
$md3-shape-aliases: (
    3xs: extra-small,
    2xs: extra-small,
    xs: extra-small,
    extra-small: extra-small,
    sm: small,
    small: small,
    md: medium,
    medium: medium,
    lg: large,
    large: large,
    xl: extra-large,
    extra-large: extra-large,
    2xl: extra-large,
    3xl: extra-extra-large,
    4xl: extra-extra-large,
    full: full,
);

//
// Breakpoint scale
$md3-breakpoints: (
    sm: 40rem,
    md: 60rem,
    lg: 75rem,
    xl: 90rem,
    2xl: 105rem,
);

//
// Container query thresholds
$md3-container-compact-max: 30rem;
$md3-container-cozy-max: 60rem;


//
// Icon sizes
$md3-icon-sizes: (
    xs: clamp(0.75rem, 0.35cqi + 0.65rem, 0.9rem),
    sm: clamp(0.95rem, 0.4cqi + 0.85rem, 1.1rem),
    md: clamp(1.25rem, 0.45cqi + 1.1rem, 1.45rem),
    lg: clamp(1.5rem, 0.6cqi + 1.3rem, 1.75rem),
    xl: clamp(2rem, 0.8cqi + 1.65rem, 2.25rem),
    2xl: clamp(2.5rem, 1cqi + 2.25rem, 3rem),
    18xs: extra-small,
    19xs: extra-small,
    20xs: extra-small,
    21xs: extra-small,
    22xs: extra-small,
    23xs: extra-small,
    24xs: extra-small,
    25xs: extra-small,
    26xs: extra-small,
    27xs: extra-small,
    28xs: extra-small,
    29xs: extra-small,
    30xs: extra-small,
    31xs: extra-small,
    full: full,
);

//
// Avatar sizes
$md3-avatar-sizes: (
    sm: clamp(2.25rem, 1cqi + 2rem, 2.75rem),
    md: clamp(2.75rem, 1.4cqi + 2.4rem, 3.5rem),
    lg: clamp(3.5rem, 1.6cqi + 3rem, 4.5rem),
);


//
// Space function
@function md3-space($token) {
    @return _.md3-fetch($md3-space-scale, $token, "space token");
}

//
// Radius function
@function md3-radius($token) {
    @if map.has-key($md3-radius-scale, $token) {
        @return map.get($md3-radius-scale, $token);
    }

    @if map.has-key($md3-radius-aliases, $token) {
        $alias: map.get($md3-radius-aliases, $token);
        @return map.get($md3-radius-scale, $alias);
    }

    @return _.md3-fetch($md3-radius-scale, $token, "radius token");
}

//
// Gap function
@function md3-gap($token) { @return md3-space($token); }

//
// Export gap vars mixin
@mixin md3-export-gap-vars() {
    @each $token, $value in $md3-space-scale {
        --gap-#{$token}: #{$value};
    }
}

//
// Padding function
@function md3-padding($token) { @return md3-space($token); }

//
// Export padding vars mixin
@mixin md3-export-padding-vars() {
    @each $token, $value in $md3-space-scale {
        --padding-#{$token}: #{$value};
    }
}

//
// Radius function
@function md3-shape($token) {
    @if map.has-key($md3-shape-scale, $token) {
        @return map.get($md3-shape-scale, $token);
    }

    @if map.has-key($md3-shape-aliases, $token) {
        $alias: map.get($md3-shape-aliases, $token);
        @return map.get($md3-shape-scale, $alias);
    }

    @error "Unknown MD3 shape token `#{$token}`. Available: #{map.keys($md3-shape-scale)}";
}

//
// State function
@function md3-opacity-state($state) {
    @return _.md3-fetch($md3-state-opacity, $state, "state token");
}

//
// Icon size function
@function md3-icon-size($token: md) {
    @return _.md3-fetch($md3-icon-sizes, $token, "icon size");
}

//
// Avatar size function
@function md3-avatar-size($token: md) {
    @return _.md3-fetch($md3-avatar-sizes, $token, "avatar size");
}

//
// Export layout vars mixin
@mixin md3-export-density-vars() {
    @each $token, $value in $md3-space-scale {
        --space-#{$token}: #{$value};
        --gap-#{$token}: #{$value};
        --padding-#{$token}: #{$value};
    }

    @each $token, $value in $md3-shape-scale {
        --radius-#{$token}: #{$value};
    }
}



@mixin md3-export-scale-vars() {
    --u: 1rem;
    --pxu: 1px;
    --cqi: 1cqi;
    --cqb: 1cqb;

    --size-scale: 1;
    --font-scale: 1;

    --container-max-width: min(100%, 110rem);
    --container-padding: clamp(1rem, 3vw, 2rem);

    @each $name, $value in $md3-breakpoints {
        --breakpoint-#{$name}: #{$value};
    }

    @container (inline-size < $md3-container-compact-max) {
        --size-scale: 0.92;
        --font-scale: 0.96;
    }

    @container ($md3-container-compact-max <= inline-size < $md3-container-cozy-max) {
        --size-scale: 1;
        --font-scale: 1;
    }

    @container (inline-size >= $md3-container-cozy-max) {
        --size-scale: 1.05;
        --font-scale: 1.04;
    }

    --sidebar-width: min(clamp(16.25rem, 28vw, 22.5rem), 100cqi);
    --sidebar-width-collapsed: min(clamp(10rem, 20vw, 12.5rem), 100cqi);
    --sidebar-width-mobile: min(clamp(17.5rem, 35vw, 20rem), 100cqi);
    --sidebar-width-mobile-small: min(clamp(18.75rem, 40vw, 21.25rem), 100cqi);

    @media (max-width: #{map.get($md3-breakpoints, md)}) {
        --sidebar-width: var(--sidebar-width-mobile);
    }

    @media (max-width: #{map.get($md3-breakpoints, sm)}) {
        --sidebar-width: var(--sidebar-width-mobile-small);
    }
}




//
// Export layout vars mixin
@mixin md3-export-layout-vars() {
    // Spacing tokens
    @each $token, $value in $md3-space-scale {
        --space-#{$token}-base: #{$value};
        --space-#{$token}: var(--space-#{$token}-base);
        --gap-#{$token}: var(--space-#{$token});
        --padding-#{$token}: var(--space-#{$token});
    }


    //
    @each $alias, $token in $md3-radius-aliases {
        --radius-#{$alias}: var(--radius-#{$token}, #{md3-radius($token)});
    }

    // Radius tokens
    @each $token, $value in $md3-radius-scale {
        --radius-#{$token}: #{$value};
    }

    --radius-full: #{md3-radius(full)};


    //
    @each $alias, $token in $md3-shape-aliases {
        --shape-#{$alias}: var(--shape-#{$token}, #{md3-shape($token)});
    }

    // Shape tokens
    @each $token, $value in $md3-shape-scale {
        --shape-#{$token}: #{$value};
    }



    // Icon & avatar sizes
    --icon-size-xs: #{md3-icon-size(xs)};
    --icon-size-sm: #{md3-icon-size(sm)};
    --icon-size-md: #{md3-icon-size(md)};
    --icon-size-lg: #{md3-icon-size(lg)};
    --icon-size-xl: #{md3-icon-size(xl)};
    --icon-size-2xl: #{md3-icon-size(2xl)};

    --avatar-size-sm: #{md3-avatar-size(sm)};
    --avatar-size: #{md3-avatar-size(md)};
    --avatar-size-lg: #{md3-avatar-size(lg)};

    // Typography scale
    --text-xs: clamp(calc(0.7rem * var(--font-scale)), 0.3cqi + 0.6rem, calc(0.75rem * var(--font-scale)));
    --text-sm: clamp(calc(0.75rem * var(--font-scale)), 0.4cqi + 0.65rem, calc(0.85rem * var(--font-scale)));
    --text-base: clamp(calc(0.8rem * var(--font-scale)), 0.5cqi + 0.7rem, calc(0.95rem * var(--font-scale)));
    --text-lg: clamp(calc(0.9rem * var(--font-scale)), 0.6cqi + 0.8rem, calc(1.1rem * var(--font-scale)));
    --text-xl: clamp(calc(1rem * var(--font-scale)), 0.8cqi + 0.9rem, calc(1.3rem * var(--font-scale)));

    // Motion tokens
    --transition-fast: 140ms ease;
    --transition-normal: 160ms ease;
    --transition-slow: 200ms ease;

    --text-opacity-disabled: #{md3-state(disabled)};
}


//
// Spacing variables
$spacing-xs: #{md3-space(xs)};
$spacing-sm: #{md3-space(sm)};
$spacing-md: #{md3-space(md)};
$spacing-lg: #{md3-space(lg)};
$spacing-xl: #{md3-space(xl)};
$spacing-2xl: #{md3-space(2xl)};
$spacing-3xl: #{md3-space(3xl)};
$spacing-4xl: #{md3-space(4xl)};

//
// Border radius variables
$border-radius-sm: #{md3-radius(sm)};
$border-radius-md: #{md3-radius(md)};
$border-radius-lg: #{md3-radius(lg)};
$border-radius-xl: #{md3-radius(xl)};
$border-radius-2xl: #{md3-radius(2xl)};
$border-radius-3xl: #{md3-radius(3xl)};
$border-radius-4xl: #{md3-radius(4xl)};
$border-radius-full: #{md3-radius(full)};

//
// Z-index variables
$z-dropdown: 1000;
$z-sticky: 1020;
$z-fixed: 1030;
$z-modal-backdrop: 1040;
$z-modal: 1050;
$z-popover: 1060;
$z-tooltip: 1070;

//
// Breakpoint variables
$breakpoint-sm: map.get($md3-breakpoints, sm);
$breakpoint-md: map.get($md3-breakpoints, md);
$breakpoint-lg: map.get($md3-breakpoints, lg);
$breakpoint-xl: map.get($md3-breakpoints, xl);
$breakpoint-2xl: map.get($md3-breakpoints, 2xl);

//
// Container max width
$container-max-width: min(100%, 110rem);

//
// Backdrop blur variables
$backdrop-blur-sm: blur(6px);
$backdrop-blur-md: blur(12px);
$backdrop-blur-lg: blur(18px);

//
// UI radius variables
$ui-radius-sm: #{md3-radius(sm)} !default;
$ui-radius-md: #{md3-radius(md)} !default;
$ui-radius-lg: #{md3-radius(lg)} !default;
$ui-radius-xl: #{md3-radius(xl)} !default;
$ui-radius-2xl: #{md3-radius(2xl)} !default;
$ui-radius-3xl: #{md3-radius(3xl)} !default;
$ui-radius-4xl: #{md3-radius(4xl)} !default;
$ui-radius-full: #{md3-radius(full)} !default;
$ui-border-width: 1px !default;

//
// UI spacing variables
$ui-spacing-2xs: #{md3-space(2xs)} !default;
$ui-spacing-xs: #{md3-space(xs)} !default;
$ui-spacing-sm: #{md3-space(sm)} !default;
$ui-spacing-md: #{md3-space(md)} !default;
$ui-spacing-lg: #{md3-space(lg)} !default;
$ui-spacing-xl: #{md3-space(xl)} !default;
$ui-spacing-2xl: #{md3-space(2xl)} !default;
$ui-spacing-3xl: #{md3-space(3xl)} !default;
$ui-spacing-4xl: #{md3-space(4xl)} !default;

//
// UI titlebar height
$ui-titlebar-height: 32px !default;
$ui-font-title-size: #{md3-type("title-small", size)} !default;
$ui-font-subtitle-size: #{md3-type("label-large", size)} !default;

//
// Mobile width
$mobile-width: 9in;

//
// Is touch
$is-touch: "screen and (hover: none) and (pointer: coarse)";
$is-not-wide: "(width < #{$mobile-width})";
$is-desktop: "(((hover: hover) or (pointer: fine)) and ((width >= #{$mobile-width}) or (orientation: landscape)))";
$is-mobile: "not #{$is-desktop}";
$is-windowed: "@container u2-windowed #{$is-not-wide}";



//
@mixin host-related($host, $child) {
    // outside web component
    #{$host} { & > #{$child} { @content; } }
    // inside web component
    :host(#{$host}) { ::slotted(#{$child}) { @content; } }
}

//
@mixin host-context($host) {
    // outside web component
    #{$host} { @content; }
    // inside web component
    :host(#{$host}) { @content; }
}


// Spacing helpers
@mixin padding($value: null) {
    & {
        @if $value != null { --p: #{$value}; }
        padding: var(--p, var(--padding-md, 0.25rem));
    }
}

//
@mixin margin($value: null) {
    & {
        @if $value != null { --m: #{$value}; }
        margin: var(--m, var(--space-md, 0rem));
    }
}

//
@mixin spacing($p: null, $m: null) {
    & {
        @if $p != null { padding: $p; }
        @if $m != null { margin: $m; }
    }
}

// Border/radius/shadow helpers
@mixin border($width: null, $style: null, $color: null) {
    & {
        @if $width != null { --border-w: #{$width}; }
        @if $style != null { --border-s: #{$style}; }
        @if $color != null { --border-c: #{$color}; }
        border-width: var(--border-w, 0.5px);
        border-style: var(--border-s, solid);
        border-color: var(--border-c, currentColor);
    }
}

// Alignment helpers
@mixin center($axis: "both") {
    & {
        @if $axis == "both" { place-content: center; place-items: center; }
        @else if $axis == "x" { justify-content: center; align-items: stretch; }
        @else if $axis == "y" { align-items: center; justify-content: stretch; }
    }
}


// Border/radius/shadow helpers
@mixin outline($width: null, $style: null, $color: null) {
    & {
        @if $width != null { --outline-w: #{$width}; }
        @if $style != null { --outline-s: #{$style}; }
        @if $color != null { --outline-c: #{$color}; }
        outline-width: var(--outline-w, 0.5px);
        outline-style: var(--outline-s, solid);
        outline-color: var(--outline-c, currentColor);
    }
}

//
@mixin radius($r: null) { & { @if $r != null { --radius: #{$r}; } border-radius: var(--radius, var(--radius-md, 0.25rem)); } }
@mixin border-radius($r: null) { & { @if $r != null { --radius: #{$r}; } border-radius: var(--radius, var(--radius-md, 0.25rem)); } }
@mixin shadow($value: null) { & { @if $value != null { --shadow: #{$value}; } box-shadow: var(--shadow); } }

// Container helpers
// pseudo-container helper for future compatibility

@mixin box($r: null, $ov: null) {
    & {
        @if $r != null { --radius: #{$r}; }
        @if $ov != null { --overflow: #{$ov}; }
        border-radius: var(--radius, var(--radius-md, 0.25rem));
        overflow: var(--overflow, visible);
    }
}

@mixin color($bg: null, $color: null) {
    & {
        @if $bg != null { --bg: #{$bg}; }
        @if $color != null { --fg: #{$color}; }
        color: var(--fg, currentColor);
        background-color: var(--bg, transparent);
    }
}





@mixin flex-center {
    display: flex;
    align-items: center;
    justify-content: center;
}

@mixin flex-between {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

@mixin hover($selector: "&") {
    & {
        @media screen and ((hover: hover) or (pointer: fine)) { #{$selector}:hover { @content; } }
        @media screen and ((hover: none) and (pointer: coarse)) { #{$selector}:active { @content; } }
    }
}

// Sizing
@mixin size($inline: null, $block: null, $aspect-ratio: null) {
    & {
        @if $inline != null { --i-size: #{$inline}; }
        @if $block != null { --b-size: #{$block}; }
        @if $aspect-ratio != null { --ar: #{$aspect-ratio}; }
        inline-size: var(--i-size, 100%);
        block-size: var(--b-size, 100%);
        aspect-ratio: var(--ar, auto);
    }
}

@mixin position($type: null, $inset: null) {
    & {
        @if $type != null { --pos: #{$type}; }
        @if $inset != null { --inset: #{$inset}; }
        position: var(--pos, absolute);
        inset: var(--inset, 0);
    }
}

@mixin display($type: null, $direction: null, $items: null, $content: null) {
    & {
        @if $type != null { --display: #{$type}; }
        @if $direction != null { --flow: #{$direction}; }
        @if $items != null { --items: #{$items}; }
        @if $content != null { --content: #{$content}; }
        display: var(--display, inline-block);
        flex-direction: var(--flow, row);
        place-items: var(--items, center);
        place-content: var(--content, center);
        box-sizing: border-box;
    }
}

@mixin interaction($pointerEvents: null, $cursor: null, $userSelect: null) {
    & {
        @if $pointerEvents != null { --pe: #{$pointerEvents}; }
        @if $userSelect != null { --us: #{$userSelect}; }
        @if $cursor != null { --cursor: #{$cursor}; }
        pointer-events: var(--pe, auto);
        user-select: var(--us, none);
        cursor: var(--cursor, default);
    }
}

@mixin scrollbar($overflow: null, $width: null, $color: null, $gutter: null) {
    & {
        @if $width != null { --sb-w: #{$width}; }
        @if $color != null { --sb-c: #{$color}; }
        @if $gutter != null { --sb-g: #{$gutter}; }
        @if $overflow != null { --ov: #{$overflow}; }
        scrollbar-width: var(--sb-w, thin);
        scrollbar-color: var(--sb-c, transparent transparent);
        scrollbar-gutter: var(--sb-g, auto);
        overflow: var(--ov, hidden);
    }
}

@mixin place($method: stretch, $items: center) {
    & { place-content: #{$method}; place-items: #{$items}; }
}

@mixin grid-flow($direction: row) {
    & {
        display: grid;
        grid-auto-flow: #{$direction};
    }
}

@mixin grid-center {
    display: grid;
    place-items: center;
}

@mixin flex-flow($direction: row) {
    & {
        display: flex;
        flex-direction: #{$direction};
    }
}

@mixin grid-column {
    @include grid-flow(row);
    @include place(center);

    & {
        --order: sibling-index();
        grid-column: var(--order, 1) / calc(var(--order, 1) + 1);
        grid-row: 1 / -1;
        grid-template-columns: minmax(0px, 1fr);
        grid-template-rows: subgrid;
    }
}

@mixin grid-row {
    @include grid-flow(column);
    @include place(center);

    & {
        --order: sibling-index();
        grid-column: 1 / -1;
        grid-row: var(--order, 1) / calc(var(--order, 1) + 1);
        grid-template-columns: subgrid;
        grid-template-rows: minmax(0px, max-content);
    }
}

@mixin flex-column {
    & {
        --order: sibling-index();
        order: var(--order, auto);
        flex: 1 1 max-content;
    }

    @include place(center);
}

@function limit-by-size($pwidth, $basis: 100%, $min: 0px) {
    @return max(calc($basis - ($basis - $pwidth)), $min);
}

@mixin inline-stretch { & { inline-size: 100%; inline-size: -webkit-fill-available; inline-size: stretch; } }
@mixin block-stretch { & { block-size: 100%; block-size: -webkit-fill-available; block-size: stretch; } }
@mixin content-inline-size { & { padding-inline: limit-by-size(calc(var(--content-inline-size, 100%) * 0.5), 100%); } }
@mixin content-block-size { & { padding-block: limit-by-size(calc(var(--content-block-size, 100%) * 0.5), 100%); } }
@mixin ux-anchor { & { transform: scale3d(var(--scale, 1), var(--scale, 1), 1) translate3d(var(--translate-x, 0px), var(--translate-y, 0px), 0px); } }

@mixin grid-layered {
    & { grid-template-columns: minmax(0px, 1fr); grid-template-rows: minmax(0px, 1fr); }
    & > * { grid-column: 1 / -1; grid-row: 1 / -1; }
}

@mixin grid-rows-3c { & { grid-template-columns: minmax(0px, max-content) minmax(0px, 1fr) minmax(0px, max-content); } }

@mixin grid-layout($columns: minmax(0px, 1fr), $rows: minmax(0px, 1fr), $type: inline) {
    display: #{$type} grid;
    grid-template-columns: #{$columns};
    grid-template-rows: #{$rows};
}

@mixin grid-auto-fill($min-size: null) {
    @if $min-size != null { --min-col-size: #{$min-size}; }
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(var(--min-col-size, 260px), 1fr));
    gap: var(--gap-md);
}

@mixin scrollable($direction: "y") {
    @if $direction == "x" {
        overflow-x: auto;
        overflow-y: hidden;
    }

    @else if $direction == "y" {
        overflow-y: auto;
        overflow-x: hidden;
    }

    @else {
        overflow: auto;
    }

    scrollbar-width: thin;
    scrollbar-color: oklch(
        from --c2-on-surface(
            var(--scrollbar-tint),
            var(--current, var(--color-on-surface, var(--md-on-surface, #1c1b1f)))
        ) l c h / var(--scrollbar-opacity)
    ) transparent;
    -webkit-overflow-scrolling: touch;

    &::-webkit-scrollbar {
        inline-size: 6px;
        block-size: 6px;
    }

    &::-webkit-scrollbar-thumb {
        background-color: oklch(
            from --c2-on-surface(
                var(--scrollbar-tint),
                var(--current, var(--color-on-surface, var(--md-on-surface, #1c1b1f)))
            ) l c h / var(--scrollbar-opacity)
        );
        border-radius: var(--radius-full);
    }

    &::-webkit-scrollbar-track {
        background-color: transparent;
    }
}

@mixin hide-scrollbar {
    scrollbar-width: none;

    &::-webkit-scrollbar {
        display: none;
    }
}

@mixin breakpoint($size) {
    $map: (
        "sm": 480px,
        "md": 720px,
        "lg": 960px,
        "xl": 1200px
    );

    $limit: map.get($map, $size);

    @if $limit {
        @media (max-width: $limit) { @content; }
    } @else {
        @media (max-width: #{$size}) { @content; }
    }
}

@mixin breakpoint-up($size) {
    $map: (
        "sm": 481px,
        "md": 721px,
        "lg": 961px,
        "xl": 1201px
    );

    $limit: map.get($map, $size);

    @if $limit {
        @media (min-width: $limit) { @content; }
    } @else {
        @media (min-width: #{$size}) { @content; }
    }
}

@mixin container-query($size) {
    $map: (
        "sm": 480px,
        "md": 720px,
        "lg": 960px
    );

    $limit: map.get($map, $size);

    @if $limit {
        @container (max-inline-size: $limit) { @content; }
    } @else {
        @container (max-inline-size: #{$size}) { @content; }
    }
}

@mixin flex($direction: row, $items: center, $content: center) {
    @include display('flex', $direction, $items, $content);
}

@mixin grid($columns: minmax(0px, 1fr), $rows: minmax(0px, var(--ui-window-frame-titlebar-height)) minmax(0px, 1fr)) {
    display: grid;
    grid-template-columns: #{$columns};
    grid-template-rows: #{$rows};
    grid-column: 1 / -1;
    grid-row: 1 / -1;
}

//
@mixin container-base($size: stretch, $strict: false, $type: size, $name: auto, $contain: strict) {
    & {
        container-type: $type;
        @if $name != auto { container-name: $name; }
        contain: $contain;
    }

    @if $strict {
        @include size($size);
    }
    @else {
        @include size(stretch);
    }
}

@mixin container-layout($type: ui-container, $contain: strict) {
    @include container-base(stretch, false, $type, auto, $contain);
}

// Container query variants
@mixin container($size) {
    max-inline-size: stretch;//$container-max-width;

    $map: (
        "sm": 480px,
        "md": 720px,
        "lg": 960px
    );

    $limit: map.get($map, $size);

    /*@include media-down(md) {
        padding: 0 $spacing-md;
    }*/

    @if $limit {
        @container (max-inline-size: $limit) { @content; }
    } @else {
        @container (max-inline-size: #{$size}) { @content; }
    }
}


@mixin text($size: $ui-font-base-size, $weight: 400, $color: currentColor) {
    font-size: #{$size};
    font-weight: #{$weight};
    color: #{$color};
}

@mixin text-ellipsis {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

// =============================================================================
// RESPONSIVE MIXINS
// =============================================================================

@mixin media-up($breakpoint) {
    @if $breakpoint == sm {
        @media (min-width: $breakpoint-sm) {
            @content;
        }
    } @else if $breakpoint == md {
        @media (min-width: $breakpoint-md) {
            @content;
        }
    } @else if $breakpoint == lg {
        @media (min-width: $breakpoint-lg) {
            @content;
        }
    } @else if $breakpoint == xl {
        @media (min-width: $breakpoint-xl) {
            @content;
        }
    } @else if $breakpoint == 2xl {
        @media (min-width: $breakpoint-2xl) {
            @content;
        }
    }
}

//
@mixin media-down($breakpoint) {
    @if $breakpoint == sm {
        @media (max-width: #{$breakpoint-sm - 1px}) {
            @content;
        }
    } @else if $breakpoint == md {
        @media (max-width: #{$breakpoint-md - 1px}) {
            @content;
        }
    } @else if $breakpoint == lg {
        @media (max-width: #{$breakpoint-lg - 1px}) {
            @content;
        }
    } @else if $breakpoint == xl {
        @media (max-width: #{$breakpoint-xl - 1px}) {
            @content;
        }
    } @else if $breakpoint == 2xl {
        @media (max-width: #{$breakpoint-2xl - 1px}) {
            @content;
        }
    }
}

@mixin media-between($min, $max) {
    @media (min-width: $min) and (max-width: #{$max - 1px}) {
        @content;
    }
}

// =============================================================================
// LAYOUT MIXINS
// =============================================================================

@mixin grid-auto-fit($min-width: 250px) {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax($min-width, 1fr));
    gap: $spacing-lg;
}

// =============================================================================
// VISUAL EFFECTS MIXINS
// (moved to design/_effects.scss)
// =============================================================================

// =============================================================================
// UTILITY MIXINS
// =============================================================================

@mixin sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

@mixin truncate {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

@mixin aspect-ratio($width, $height) {
    position: relative;

    &::before {
        content: "";
        display: block;
        padding-top: calc(#{$height} / #{$width} * 100%);
    }

    & > * {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }
}





//
@mixin fit-content-inline {
    interpolate-size: allow-keywords;
    min-inline-size: min-content;
    max-inline-size: stretch;
    inline-size: fit-content;
}

//
@mixin fit-content-block {
    interpolate-size: allow-keywords;
    min-block-size: min-content;
    max-block-size: stretch;
    block-size: fit-content;
}

//
@mixin stretch-inline {
    interpolate-size: allow-keywords;
    max-inline-size: stretch;
    inline-size: stretch;
}

//
@mixin stretch-block {
    interpolate-size: allow-keywords;
    max-block-size: stretch;
    block-size: stretch;
}

//
@mixin stretch {
    interpolate-size: allow-keywords;
    max-inline-size: stretch;
    max-block-size: stretch;
    inline-size: stretch;
    block-size: stretch;
}

//
@mixin container-inline-clamped($inline: max-content) {
    interpolate-size: allow-keywords;
    max-inline-size: stretch;
    inline-size: calc-size($inline, clamp(0px, size, min(100cqi, 100dvi)));
    min-inline-size: min-content;
}

//
@mixin container-block-clamped($block: max-content) {
    interpolate-size: allow-keywords;
    max-block-size: stretch;
    block-size: calc-size($block, clamp(0px, size, min(100cqb, 100dvb)));
    min-block-size: min-content;
}

//
@mixin container-clamped($inline: max-content, $block: max-content) {
    interpolate-size: allow-keywords;
    @include container-inline-clamped($inline);
    @include container-block-clamped($block);
}
