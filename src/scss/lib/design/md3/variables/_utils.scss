@use "sass:list";
@use "sass:map";
@use "sass:math";
@use "sass:meta";
@use "sass:string";

//
// Fetch function
@function md3-fetch($source, $token, $label: "token") {
    @if map.has-key($source, $token) {
        @return map.get($source, $token);
    }

    @error "Unknown #{$label} `#{$token}`. Available: #{map.keys($source)}";
}

// State layer mixin
@mixin md3-state-layer($role: primary, $state: hover, $selector: "&::after") {
    $opacity: md3-opacity-state($state);
    $role-var: md3-var($role);
    $weight: calc(100% * #{$opacity});//math.percentage($opacity);

    @if $selector == "&::after" or $selector == "&::before" {
        position: relative;
        overflow: hidden;
    }

    #{$selector} {
        content: "";
        position: absolute;
        inset: 0;
        background-color: color-mix(in oklch, var(#{$role-var}) #{$weight}, transparent);
        opacity: 0;
        pointer-events: none;
        transition: opacity var(--duration-fast) var(--ease-out);
    }

    @if $state == hover {
        &:hover #{$selector} { opacity: $opacity; }
    }

    @else if $state == focus {
        &:focus #{$selector},
        &:focus-visible #{$selector} { opacity: $opacity; }
    }

    @else if $state == press {
        &:active #{$selector} { opacity: $opacity; }
    }

    @else {
        &:is(:hover, :focus-visible, :active) #{$selector} { opacity: $opacity; }
    }
}
