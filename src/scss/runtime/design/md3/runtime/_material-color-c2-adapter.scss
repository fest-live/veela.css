@use "veela-lib" as mc2;



@mixin make-md-theme($suffix: "", $theme-type: 2) {
    --md-c2-primary#{$suffix}: var(--current, var(--primary-fallback, #469));
    --md-c2-secondary#{$suffix}: var(--secondary, var(--secondary-fallback, var(--md-c2-primary#{$suffix})));
    --md-c2-tertiary#{$suffix}: var(--tertiary, var(--tertiary-fallback, var(--md-c2-secondary#{$suffix})));
    --md-c2-error#{$suffix}: var(--color-error, var(--color-danger, oklch(0.62 0.17 23 / 1)));
    --md-c2-neutral#{$suffix}: var(--surface-fallback, --c2-surface(0.2, var(--md-c2-primary#{$suffix}), #{$theme-type}));

    --md-c2-surface-shift#{$suffix}: clamp(0, calc(var(--background-tone-shift, 0.0) + 0.16), 1);
    --md-c2-on-surface-shift#{$suffix}: clamp(0, calc(var(--color-tone-shift, 0.0) + 0.06), 1);
    --md-c2-surface-variant-shift#{$suffix}: clamp(0, calc(var(--background-tone-shift, 0.0) + 0.34), 1);
    --md-c2-outline-shift#{$suffix}: clamp(0, calc(var(--color-tone-shift, 0.0) + 0.28), 1);
    --md-c2-contrast-shift#{$suffix}: clamp(0, calc(0.88 - var(--background-tone-shift, 0.0) * 0.3), 1);
    --md-c2-inverse-primary-shift#{$suffix}: clamp(0, calc(0.7 - var(--background-tone-shift, 0.0) * 0.2), 1);

    --md-sys-color-primary#{$suffix}: var(--md-c2-primary#{$suffix});
    --md-sys-color-on-primary#{$suffix}: --c2-on-contrast(0.02, var(--md-c2-primary#{$suffix}), #{$theme-type});
    --md-sys-color-primary-container#{$suffix}: --c2-surface(0.74, var(--md-c2-primary#{$suffix}), #{$theme-type});
    --md-sys-color-on-primary-container#{$suffix}: --c2-on-surface(0.26, var(--md-c2-primary#{$suffix}), #{$theme-type});

    --md-sys-color-secondary#{$suffix}: var(--md-c2-secondary#{$suffix});
    --md-sys-color-on-secondary#{$suffix}: --c2-on-contrast(0.02, var(--md-c2-secondary#{$suffix}), #{$theme-type});
    --md-sys-color-secondary-container#{$suffix}: --c2-surface(0.68, var(--md-c2-secondary#{$suffix}), #{$theme-type});
    --md-sys-color-on-secondary-container#{$suffix}: --c2-on-surface(0.24, var(--md-c2-secondary#{$suffix}), #{$theme-type});

    --md-sys-color-tertiary#{$suffix}: var(--md-c2-tertiary#{$suffix});
    --md-sys-color-on-tertiary#{$suffix}: --c2-on-contrast(0.02, var(--md-c2-tertiary#{$suffix}), #{$theme-type});
    --md-sys-color-tertiary-container#{$suffix}: --c2-surface(0.64, var(--md-c2-tertiary#{$suffix}), #{$theme-type});
    --md-sys-color-on-tertiary-container#{$suffix}: --c2-on-surface(0.22, var(--md-c2-tertiary#{$suffix}), #{$theme-type});

    --md-sys-color-error#{$suffix}: var(--md-c2-error#{$suffix});
    --md-sys-color-on-error#{$suffix}: --c2-on-contrast(0.02, var(--md-c2-error#{$suffix}), #{$theme-type});
    --md-sys-color-error-container#{$suffix}: --c2-surface(0.72, var(--md-c2-error#{$suffix}), #{$theme-type});
    --md-sys-color-on-error-container#{$suffix}: --c2-on-surface(0.24, var(--md-c2-error#{$suffix}), #{$theme-type});

    --md-sys-color-surface#{$suffix}: --c2-surface(var(--md-c2-surface-shift#{$suffix}), var(--md-c2-neutral#{$suffix}), #{$theme-type});
    --md-sys-color-on-surface#{$suffix}: --c2-on-surface(var(--md-c2-on-surface-shift#{$suffix}), var(--md-c2-neutral#{$suffix}), #{$theme-type});
    --md-sys-color-surface-variant#{$suffix}: --c2-surface(var(--md-c2-surface-variant-shift#{$suffix}), var(--md-c2-neutral#{$suffix}), #{$theme-type});
    --md-sys-color-on-surface-variant#{$suffix}: --c2-on-surface(clamp(0, calc(var(--md-c2-on-surface-shift#{$suffix}) + 0.14), 1), var(--md-c2-neutral#{$suffix}), #{$theme-type});

    --md-sys-color-outline#{$suffix}: color-mix(in oklch, --c2-on-surface(var(--md-c2-outline-shift), var(--md-c2-neutral#{$suffix}), #{$theme-type}) 58%, transparent);
    --md-sys-color-outline-variant#{$suffix}: color-mix(
        in oklch,
        --c2-on-surface(clamp(0, calc(var(--md-c2-outline-shift#{$suffix}) + 0.1), 1), var(--md-c2-neutral#{$suffix}), #{$theme-type}) 34%,
        --c2-surface(var(--md-c2-surface-variant-shift#{$suffix}), var(--md-c2-neutral#{$suffix}), #{$theme-type}) 66%
    );

    --md-sys-color-background#{$suffix}: --c2-surface(var(--background-tone-shift, 0.0), var(--md-c2-neutral#{$suffix}), #{$theme-type});
    --md-sys-color-on-background#{$suffix}: --c2-on-surface(var(--color-tone-shift, 0.0), var(--md-c2-neutral#{$suffix}), #{$theme-type});

    --md-sys-color-inverse-surface#{$suffix}: --c2-contrast(var(--md-c2-contrast-shift#{$suffix}), var(--md-c2-neutral#{$suffix}), #{$theme-type});
    --md-sys-color-inverse-on-surface#{$suffix}: --c2-on-contrast(clamp(0, calc(var(--md-c2-on-surface-shift#{$suffix}) + 0.06), 1), var(--md-c2-neutral#{$suffix}), #{$theme-type});
    --md-sys-color-inverse-primary#{$suffix}: --c2-contrast(var(--md-c2-inverse-primary-shift#{$suffix}), var(--md-c2-primary#{$suffix}), #{$theme-type});

    --md-sys-color-surface-tint#{$suffix}: var(--md-c2-primary#{$suffix});
    --md-sys-color-shadow#{$suffix}: color-mix(in oklch, var(--md-c2-neutral#{$suffix}) 24%, transparent);
    --md-sys-color-scrim#{$suffix}: color-mix(in oklch, var(--md-c2-neutral#{$suffix}) 70%, transparent);
}



//
@mixin material-color-c2-adapter-remap($selector: ":where(:root, :host, :scope, body, div, section)") {
    @layer md3.c2-adapter {
        #{$selector} {
            @include make-md-theme("", 2);
            @include make-md-theme("-dark", 1);
            @include make-md-theme("-light", 0);
        }
    }
}

//
@mixin material-color-backward-adapter($selector: ":where(:root, :host, :scope, body, div, section)") {
    @layer md3.c2-adapter {
        #{$selector} {
            --primary: var(--md-sys-color-primary, var(--primary-fallback, #469));
            --secondary: var(--md-sys-color-secondary, var(--secondary-fallback, var(--primary)));
            --tertiary: var(--md-sys-color-tertiary, var(--tertiary-fallback, var(--secondary)));
            --trinary: var(--tertiary);
            --accent: var(--md-sys-color-tertiary, var(--accent-fallback, var(--tertiary)));
            --current: var(--primary);

            --color-primary: var(--current);
            --color-secondary: var(--secondary);
            --color-tertiary: var(--tertiary);

            --color-surface: var(--md-sys-color-surface, var(--surface-fallback));
            --color-surface-variant: var(--md-sys-color-surface-variant, var(--surface-variant-fallback, var(--surface-fallback)));
            --color-background: var(--md-sys-color-background, var(--surface-fallback));
            --color-on-surface: var(--md-sys-color-on-surface, var(--on-surface-fallback));
            --color-on-background: var(--md-sys-color-on-background, var(--on-surface-fallback));

            --color-outline: var(--md-sys-color-outline, var(--outline-fallback));
            --color-outline-variant: var(--md-sys-color-outline-variant, var(--outline-variant-fallback, var(--outline-fallback)));

            --inverse-surface: var(--md-sys-color-inverse-surface, var(--inverse-surface-fallback, var(--surface-fallback)));
            --inverse-on-surface: var(--md-sys-color-inverse-on-surface, var(--inverse-on-surface-fallback, var(--on-surface-fallback)));
            --inverse-primary: var(--md-sys-color-inverse-primary, var(--inverse-primary-fallback, var(--current)));
        }
    }
}

//
@include material-color-c2-adapter-remap();
