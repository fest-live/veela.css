@use "veela-lib" as *;

$ux-input-button-types: '[type="button"], [type="submit"], [type="reset"]';
$ux-textual-input-types: '[type="text"], [type="email"], [type="url"], [type="tel"], [type="password"], [type="search"], [type="number"], [type="date"], [type="time"], [type="datetime-local"], [type="month"], [type="week"]';
$ux-numeric-temporal-types: '[type="number"], [type="date"], [type="time"], [type="datetime-local"], [type="month"], [type="week"]';

@mixin ux-define-surface($property, $surface-token) {
    #{$property}: calc(#{$surface-token} * var(--ux-tone-direction, 1));
}

@mixin ux-solid-state($surface-token, $property: --ux-state-base, $tint: 0.0) {
    @include solid-colorize-selector-only("&", ("shade": var(#{$property}), "tint": $tint));
    @include ux-define-surface($property, $surface-token);
}

//
@mixin ux-textual-interaction {
    @include ux-solid-state(var(--surface-opacity-subtle));
    @include input-base();
    @include button-base();

    & {
        display: inline-block;
        flex-direction: row;
        justify-items: stretch;
        justify-content: space-between;
        text-align: start;
    }

    &:invalid:not(:disabled) {
        --current: var(--color-error, var(--color-danger));
    }

    &:placeholder-shown {
        --color-tint: var(--text-tint-muted);
    }

    &::placeholder {
        color: oklch(from var(--current) l c h / calc(var(--text-tint-muted) + 0.1));
        opacity: 0.7;
    }
}

//
@layer ux-states {
    :where(:root, :host, :scope, body) {
        --ux-tone-direction: var(--interaction-tone-direction, 1);
    }



    ui-longtext {
        --thumb-size: 1.25rem;
        --track-height: 0.25rem;
        display: inline-block;
    }

    ui-slider[variant="slider"] {
        block-size: 1rem;
        border-radius: 9999px;
    }

    //
    :where(button, input:is(#{$ux-input-button-types})) {
        &:not([data-variant]):not([data-icon-only]) {
            @include button-elevated(primary);
        }

        &[data-variant="filled"] {
            @include button-filled(primary, false);
        }

        &[data-variant="tonal"] {
            @include button-tonal(secondary-container, secondary, false);
        }

        &[data-variant="outlined"] {
            @include button-outlined(primary, false);
        }

        &[data-variant="text"] {
            @include button-text(primary, false);
        }
    }

    // Enhanced select dropdown styling
    :where(textarea) { @include form-field-base; }



    // =============================================================================
    // BUTTONS
    // =============================================================================

    :where(button) {
        @include ux-solid-state(var(--surface-opacity-default));
        @include button-filled();

        & {
            display: flex-inline;
            place-content: center;
            place-items: center;
            text-align: center;
        }
    }


    // =============================================================================
    // CHECKBOX & RADIO INPUTS
    // =============================================================================

    :where(input:is([type="checkbox"], [type="radio"]), button[data-icon-only]) {
        @include ux-solid-state(var(--surface-opacity-subtle));
        @include checkbox-base();

        //
        &:is([type="radio"]) {
            border-radius: var(--radius-full);
        }
    }


    // =============================================================================
    // TEXT INPUTS (text, number, email, password, search, tel, url, date, time, datetime-local, month, week)
    // =============================================================================

    //
    :where(input) {
        &::-webkit-outer-spin-button,
        &::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        &:where(#{$ux-numeric-temporal-types}) {
            font-variant-numeric: tabular-nums;
        }
    }

    //
    :where(input:is(#{$ux-textual-input-types}), textarea) {
        @include ux-textual-interaction;

        & {
            inline-size: stretch;
            min-inline-size: fit-content;
            justify-content: space-between;
            justify-items: stretch;
            display: inline-block;
            cursor: text;
        }

        &:is(input[type="datetime-local"]) {
            font-variant-numeric: tabular-nums;
            padding-inline-end: calc(var(--space-lg) * 2);
            border-width: 0.5px;

            // Enhanced calendar icon styling
            &::-webkit-calendar-picker-indicator {
                cursor: pointer;
                filter: opacity(0.6);
                transition: filter var(--transition-normal);
                float: right; justify-self: end;

                &:where(:hover, :focus-visible, :active) {
                    filter: opacity(1);
                }
            }

            &::-webkit-datetime-edit {
                @include solid-colorize-selector-only("&");
                & { background: transparent; float: right; justify-self: end; }
            }
        }
    }

    //
    input[type="date"], input[type="time"], input[type="datetime-local"], input[type="month"], input[type="week"] {
        &::-webkit-calendar-picker-indicator {
            cursor: pointer;
            filter: opacity(0.6);
            transition: filter var(--transition-normal);
            float: right; justify-self: end;

            &:where(:hover, :focus-visible, :active) {
                filter: opacity(1);
            }
        }

        &::-webkit-datetime-edit {
            @include solid-colorize-selector-only("&");
            & { background: transparent; float: right; justify-self: end; }
        }
    }


    // =============================================================================
    // SELECT ELEMENT
    // =============================================================================

    :where(select) {
        @include ux-solid-state(var(--surface-opacity-subtle));
        @include select-base;

        //
        &:invalid:not(:disabled) {
            --current: var(--color-error, var(--color-danger));
        }
    }

    // =============================================================================
    // RANGE INPUT
    // =============================================================================

    :where(input[type="range"]) {
        @include ux-solid-state(var(--surface-opacity-subtle));
        @include ux-define-surface(--ux-thumb-base, var(--surface-opacity-emphasis));

        &::-webkit-slider-thumb,
        &::-moz-range-thumb {
            @include solid-colorize-selector-only("&", ("shade": var(--ux-thumb-base), "tint": 0.0));
        }

        &:where(:hover, :focus, :focus-visible, :active):not(:disabled) {
            &::-webkit-slider-thumb,
            &::-moz-range-thumb {
                --color-shade: veela-state-shade(var(--ux-thumb-base, 0), 0.05);
            }
        }

        &:disabled {
            &::-webkit-slider-thumb,
            &::-moz-range-thumb {
                --color-shade: var(--ux-thumb-base, 0);
            }
        }
    }


    // =============================================================================
    // FILE & COLOR INPUTS
    // =============================================================================

    :where(input:is([type="file"], [type="color"])) {
        @include ux-solid-state(var(--surface-opacity-subtle));
    }

    :where(button, input, textarea, select):disabled {
        cursor: not-allowed;
    }


    // =============================================================================
    // PROGRESS ELEMENT
    // =============================================================================

    :where(progress) {
        @include ux-solid-state(var(--surface-opacity-subtle));

        //
        &::-webkit-progress-bar {
            @include ux-solid-state(var(--surface-opacity-subtle));
        }

        //
        &::-webkit-progress-value,
        &::-moz-progress-bar {
            @include ux-solid-state(var(--surface-opacity-emphasis));
        }
    }


    // =============================================================================
    // METER ELEMENT
    // =============================================================================

    :where(meter) {
        @include ux-solid-state(var(--surface-opacity-subtle));

        //
        &::-webkit-meter-bar {
            @include ux-solid-state(var(--surface-opacity-subtle));
        }

        //
        &::-webkit-meter-optimum-value {
            --current: var(--color-success);
            @include ux-solid-state(var(--surface-opacity-emphasis));
        }

        //
        &::-webkit-meter-suboptimum-value {
            --current: var(--color-warning);
            @include ux-solid-state(var(--surface-opacity-emphasis));
        }

        //
        &::-webkit-meter-even-less-good-value {
            --current: var(--color-danger);
            @include ux-solid-state(var(--surface-opacity-emphasis));
        }
    }

}
