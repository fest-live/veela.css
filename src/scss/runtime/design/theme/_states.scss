@use "veela-lib" as *;

//
$ux-input-button-types: '[type="button"], [type="submit"], [type="reset"]';
$ux-textual-input-types: '[type="text"], [type="email"], [type="url"], [type="tel"], [type="password"], [type="search"], [type="number"], [type="date"], [type="time"], [type="datetime-local"], [type="month"], [type="week"]';
$ux-numeric-temporal-types: '[type="number"], [type="date"], [type="time"], [type="datetime-local"], [type="month"], [type="week"]';

//
@mixin ux-textual-interaction {
    @include input-base();
    @include button-base();

    & {
        display: inline-block;
        flex-direction: row;
        justify-items: stretch;
        justify-content: space-between;
        text-align: start;
    }

    &:invalid:not(:disabled) {
        --current: var(--color-error, var(--color-danger));
    }

    &:placeholder-shown {
        --color-tint: var(--text-tint-muted);
    }

    &::placeholder {
        color: oklch(from var(--current) l c h / calc(var(--text-tint-muted) + 0.1));
        opacity: 0.7;
    }
}

//
@layer ux-states {
    :where(:root, :host, :scope, body) {
        --ux-tone-direction: var(--interaction-tone-direction, 1);
    }

    //
    :where(:root, :host, :scope) {
        @include solid-colorize("&");
        @include initial-properties();
    }

    //
    :where(input, option, textarea, select, button) {
        @include solid-colorize("&");
        @include initial-properties();
    }

    :where(input, option, textarea, select, button):disabled {
        cursor: not-allowed;
    }

    //
    ui-longtext {
        --thumb-size: 1.25rem;
        --track-height: 0.25rem;
        display: inline-block;
    }

    ui-slider[variant="slider"] {
        block-size: 1rem;
        border-radius: 9999px;
    }

    //
    :where(button, input:is(#{$ux-input-button-types})) {
        &:not([data-variant]):not([data-icon-only]) {
            @include button-elevated(primary);
        }

        &[data-variant="filled"] {
            @include button-filled(primary, false);
        }

        &[data-variant="tonal"] {
            @include button-tonal(secondary-container, secondary, false);
        }

        &[data-variant="outlined"] {
            @include button-outlined(primary, false);
        }

        &[data-variant="text"] {
            @include button-text(primary, false);
        }
    }



    // =============================================================================
    // BUTTONS
    // =============================================================================

    :where(button) {
        @include button-filled();

        & {
            display: flex-inline;
            place-content: center;
            place-items: center;
            text-align: center;
        }
    }



    // =============================================================================
    // TEXT INPUTS (text, number, email, password, search, tel, url, date, time, datetime-local, month, week)
    // =============================================================================

    //
    :where(input) {
        &::-webkit-outer-spin-button,
        &::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        &:where(#{$ux-numeric-temporal-types}) {
            font-variant-numeric: tabular-nums;
        }
    }

    //
    :where(input:is(#{$ux-textual-input-types}), textarea) {
        @include ux-textual-interaction;

        & {
            inline-size: stretch;
            min-inline-size: 0px;
            max-inline-size: stretch;
            justify-content: space-between;
            justify-items: stretch;
            display: inline-block;
            block-size: fit-content;
            cursor: text;
        }

        &:is(input[type="datetime-local"]) {
            font-variant-numeric: tabular-nums;
            padding-inline-end: calc(var(--space-lg) * 2);

            // Enhanced calendar icon styling
            &::-webkit-calendar-picker-indicator {
                cursor: pointer; opacity: 0.8;
                float: end; justify-self: end;

                &:where(:hover, :focus-visible, :active)
                    {opacity: 1; }
            }

            //
            &::-webkit-datetime-edit {
                & { background-color: transparent; float: end; justify-self: end; }
            }
        }
    }

    // Enhanced select dropdown styling
    :where(textarea) {
        @include form-field-base;
        & { display: block; inline-size: stretch; }
    }

    //
    input[type="date"], input[type="time"], input[type="datetime-local"], input[type="month"], input[type="week"] {
        &::-webkit-calendar-picker-indicator {
            cursor: pointer; opacity: 0.8;
            transition: filter var(--transition-normal);
            float: end; justify-self: end;

            &:where(:hover, :focus-visible, :active)
                { opacity: 1; }
        }

        &::-webkit-datetime-edit {
            & { background-color: transparent; float: end; justify-self: end; }
        }
    }



    // =============================================================================
    // CHECKBOX & RADIO INPUTS
    // =============================================================================

    :where(input:is([type="checkbox"], [type="radio"]), button[data-icon-only]) {
        @include checkbox-base();

        //
        &:is([type="radio"]) {
            border-radius: var(--radius-full);
        }
    }



    // =============================================================================
    // SELECT ELEMENT
    // =============================================================================

    :where(select) {
        @include select-base;

        //
        &:invalid:not(:disabled) {
            --current: var(--color-error, var(--color-danger));
        }
    }

    // =============================================================================
    // RANGE INPUT
    // =============================================================================

    :where(input[type="range"]) {
        &::-webkit-slider-thumb,
        &::-moz-range-thumb {
            @include solid-colorize("&", ("shade": var(--ux-thumb-base), "tint": 0.0, "scope": "selector"));
        }

        &:where(:hover, :focus, :focus-visible, :active):not(:disabled) {
            &::-webkit-slider-thumb,
            &::-moz-range-thumb {
                --color-shade: veela-state-shade(var(--ux-thumb-base, 0), 0.05);
            }
        }

        &:disabled {
            &::-webkit-slider-thumb,
            &::-moz-range-thumb {
                --color-shade: var(--ux-thumb-base, 0);
            }
        }
    }


    // =============================================================================
    // FILE & COLOR INPUTS
    // =============================================================================



    // =============================================================================
    // PROGRESS ELEMENT
    // =============================================================================



    // =============================================================================
    // METER ELEMENT
    // =============================================================================

    :where(meter) {
        //
        &::-webkit-meter-optimum-value {
            --current: var(--color-success);
        }

        //
        &::-webkit-meter-suboptimum-value {
            --current: var(--color-warning);
        }

        //
        &::-webkit-meter-even-less-good-value {
            --current: var(--color-danger);
        }
    }

}
